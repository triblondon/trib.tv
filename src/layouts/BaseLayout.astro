---
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

interface Props {
    pageTitle?: string;
    showHeader?: boolean;
    robots?: Array<'noindex' | 'nofollow' | 'none'>;
}

import "../styles/reset.css";
import "../styles/base.css";
import "../styles/label-layouts.css";

const { pageTitle, showHeader, robots } = {
    pageTitle: null,
    showHeader: true,
    robots: [],
    ...Astro.props
};
---

<html lang="en">
    <head>
        <title>{`${pageTitle ? pageTitle + ' - ' : ''}Andrew Betts`}</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link href="https://fonts.googleapis.com/css2?family=Geo:ital@0;1&family=Manrope:wght@200..800&display=swap" rel="stylesheet">
        <link rel="icon" href="/favicon.svg">
        <link rel="alternate" type="application/rss+xml" title="Andrew Betts" href="/feed" />
        <meta name="theme-color" content="#ffffff">
        <meta name="description" content="Web developer, standards and engineering nerd, cocktail enthusiast, maker.">
        {robots.length > 0 ? <meta name="robots" content={robots.join(', ')} /> : null}
        <script is:inline type="speculationrules">
        {
            "prerender": [
                { 
                    "where": { "selector_matches": ".pre-render" },
                    "eagerness": "eager"
                }
            ],
            "prefetch": [
                {
                    "urls": ["/"],
                    "eagerness": "immediate"
                },
                { 
                    "where": { "href_matches": "/*" },
                    "eagerness": "moderate"
                }
            ]
        }
        </script>
    </head>

    <body>
        {showHeader && (<Header />)}
        <slot />
        <Footer />
        <script>
            (function() {
                const isTouchCapable = ('ontouchstart' in window || navigator.maxTouchPoints > 0);

                const processInteraction = (e: Event) => {
                    if (!(e.target instanceof HTMLElement)) return;
                    const a = e.target.closest('a');
                    if (!a) return;
                    if (e.type === 'touchstart' && e instanceof TouchEvent) {
                        document.querySelectorAll('a.pressed').forEach(el => el.classList.remove('pressed'));
                        a.classList.add('pressed');
                        a.dataset.touchX = String(e.changedTouches[0].clientX);
                        a.dataset.touchY = String(e.changedTouches[0].clientY);
                    } else if (e.type === 'touchmove' && e instanceof TouchEvent && a.classList.contains('pressed')) {
                        const touchX = parseFloat(a.dataset.touchX || '0');
                        const touchY = parseFloat(a.dataset.touchY || '0');
                        const deltaX = Math.abs(e.changedTouches[0].clientX - touchX);
                        const deltaY = Math.abs(e.changedTouches[0].clientY - touchY);
                        const big = deltaX > 10 || deltaY > 10;
                        if (big) a.classList.remove('pressed');
                    } else if (e.type === 'touchend' && a.classList.contains('pressed')) {
                        e.preventDefault();
                        requestAnimationFrame(() => {
                            window.location.href = a.href;
                        });
                    }
                };

                if (isTouchCapable) {
                    document.addEventListener('touchstart', processInteraction, { passive: true });
                    document.addEventListener('touchmove', processInteraction, { passive: true });
                    document.addEventListener('touchend', processInteraction);
                }
            })();
        </script>
    </body>
</html>
